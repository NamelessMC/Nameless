tinymce.PluginManager.add("spoiler",function(e,t){function o(){var t=e.selection,o=t.getNode();o&&(e.undoManager.transact(function(){var e=t.getContent();e||(e="Spoiler text."),t.setContent('<div class="spoiler"><div class="spoiler-toggle">'+a+' </div><div class="spoiler-text">'+e+"</div></div>")}),e.nodeChanged())}function n(){var t=e.selection,o=t.getNode();o&&"spoiler"==o.className&&(e.undoManager.transact(function(){var e=document.createElement("p");e.innerHTML=o.getElementsByClassName("spoiler-text")[0].innerHTML,o.parentNode.replaceChild(e,o)}),e.nodeChanged())}var i=e.$;e.contentCSS.push(t+"/css/spoiler.css");var a=e.getParam("spoiler_caption","Spoiler");e.on("PreProcess",function(e){i('div[class*="spoiler"]',e.node).each(function(e,t){t.hasAttribute("contenteditable")&&t.removeAttribute("contentEditable")})}),e.on("SetContent",function(){i('div[class*="spoiler"]').each(function(e,t){if(!t.hasAttribute("contenteditable")){var o=i(t);o.hasClass("spoiler")?t.contentEditable=!1:o.hasClass("spoiler-text")&&(t.contentEditable=!0)}})}),e.ui.registry.addButton("spoiler-add",{tooltip:"Add spoiler",icon:"preview",onAction:o}),e.ui.registry.addMenuItem("spoiler-add",{text:"Add spoiler",context:"format",onAction:o}),e.ui.registry.addButton("spoiler-remove",{tooltip:"Remove spoiler",icon:"cancel",onAction:n}),e.ui.registry.addMenuItem("spoiler-remove",{text:"Remove spoiler",context:"format",onAction:n})});